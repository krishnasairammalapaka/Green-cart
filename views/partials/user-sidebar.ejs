<div class="bg-green-600 text-white w-64 py-6 flex flex-col">
    <div class="px-6 mb-8 flex items-center">
        <svg class="w-8 h-8 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
        <h1 class="text-2xl font-bold">My Account</h1>
    </div>
    <nav class="flex-1 space-y-1">
        <a href="/user/dashboard" 
           class="flex items-center px-6 py-3 hover:bg-green-700 <%= currentPage === 'dashboard' ? 'bg-green-700' : '' %>">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
            </svg>
            <span>Dashboard</span>
        </a>
        
        <a href="/user/marketplace" 
           class="flex items-center px-6 py-3 hover:bg-green-700 <%= currentPage === 'marketplace' ? 'bg-green-700' : '' %>">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
            </svg>
            <span>Marketplace</span>
        </a>

        <a href="/user/orders" 
           class="flex items-center px-6 py-3 hover:bg-green-700 <%= currentPage === 'orders' ? 'bg-green-700' : '' %>">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            <div class="flex items-center justify-between flex-1">
                <span>My Orders</span>
                <% if (typeof orderCount !== 'undefined' && orderCount > 0) { %>
                    <span class="ml-2 px-2 py-1 text-xs bg-green-700 rounded-full">
                        <%= orderCount %>
                    </span>
                <% } %>
            </div>
        </a>

        <a href="/user/cart" 
           class="flex items-center px-6 py-3 hover:bg-green-700 <%= currentPage === 'cart' ? 'bg-green-700' : '' %> relative group">
            <div class="relative inline-flex">
                <svg class="w-5 h-5 mr-3 transition-transform duration-300 group-hover:scale-110" 
                     fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                    </path>
                </svg>
                <% if (typeof cartCount !== 'undefined' && cartCount > 0) { %>
                    <div id="cartBadge" 
                         class="cart-badge absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center animate-bounce">
                        <%= cartCount %>
                    </div>
                <% } %>
            </div>
            <span class="flex-grow">Shopping Cart</span>
            <% if (typeof cartCount !== 'undefined' && cartCount > 0) { %>
                <span class="cart-items ml-2 px-2 py-1 text-xs bg-green-700 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <%= cartCount %> items
                </span>
            <% } %>
        </a>

        <a href="/user/profile" 
           class="flex items-center px-6 py-3 hover:bg-green-700 <%= currentPage === 'profile' ? 'bg-green-700' : '' %>">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span>Profile</span>
        </a>

        <div class="border-t border-green-700 my-2"></div>

        <a href="/user/logout" 
           class="flex items-center px-6 py-3 hover:bg-green-700 text-red-200 hover:text-white">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            <span>Logout</span>
        </a>
    </nav>
</div>

<style>
    @keyframes badgeBounce {
        0%, 100% {
            transform: translateY(0) scale(1);
        }
        50% {
            transform: translateY(-3px) scale(1.1);
        }
    }

    .cart-badge {
        animation: badgeBounce 1s ease-in-out infinite;
    }

    .group:hover .cart-badge {
        animation: none;
        transform: scale(1.1);
    }

    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.8);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .cart-count-update {
        animation: fadeInScale 0.3s ease-out;
    }

    .cart-items {
        transition: all 0.3s ease;
    }

    .group:hover .cart-items {
        transform: translateX(-5px);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentCount = parseInt('<%= typeof cartCount !== "undefined" ? cartCount : 0 %>');
    
    function updateCartBadge(newCount) {
        const cartBadge = document.getElementById('cartBadge');
        const cartItems = document.querySelector('.cart-items');
        
        if (cartBadge) {
            // Update count with animation
            if (newCount !== currentCount) {
                cartBadge.classList.add('cart-count-update');
                setTimeout(() => cartBadge.classList.remove('cart-count-update'), 300);
            }
            
            cartBadge.textContent = newCount;
            if (cartItems) {
                cartItems.textContent = `${newCount} items`;
            }
            
            // Show/hide badge based on count
            cartBadge.style.display = newCount > 0 ? 'flex' : 'none';
            if (cartItems) {
                cartItems.style.display = newCount > 0 ? 'block' : 'none';
            }
        }
        
        currentCount = newCount;
    }

    async function fetchCartCount() {
        try {
            const response = await fetch('/user/cart/count');
            if (!response.ok) throw new Error('Failed to fetch cart count');
            const data = await response.json();
            updateCartBadge(data.count);
        } catch (error) {
            console.error('Error fetching cart count:', error);
        }
    }

    // Update cart count every 10 seconds
    setInterval(fetchCartCount, 10000);

    // Initial fetch
    fetchCartCount();

    // Listen for custom cart update events
    window.addEventListener('cartUpdated', function(e) {
        if (e.detail && typeof e.detail.count === 'number') {
            updateCartBadge(e.detail.count);
        }
    });
});
</script> 